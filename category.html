<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>أحاديث حسب التصنيف</title>
  <meta name="description" content="البحث في الأحاديث النبوية الشريفة والفتاوى.">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Amiri', serif;
      background-color: #FDF6E3; /* Vintage paper background */
    }
     .animate-spin {
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="text-stone-800">

  <main class="max-w-4xl mx-auto p-4 sm:p-6 md:p-8">
    <div class="flex justify-between items-center mb-8">
        <h1 class="text-3xl font-bold text-stone-800">
            أحاديث في: <span id="category-name" class="text-amber-700">...</span>
        </h1>
        <a href="./index.html" class="px-4 py-2 bg-stone-200 text-stone-800 font-semibold rounded-lg hover:bg-stone-300 transition-colors">
            &rarr; رجوع للبحث
        </a>
    </div>

    <div id="results-container">
        <!-- Results will be rendered here -->
    </div>
  </main>
  
  <button id="font-size-toggle-btn" class="fixed bottom-4 right-4 bg-amber-600 text-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center text-xl font-bold hover:bg-amber-700 transition-colors z-50" aria-label="تغيير حجم الخط" title="تغيير حجم الخط">
    A+
  </button>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- CONSTANTS ---
        const ORDS_API_BASE_URL = "https://g85b062bd5c6cb1-fatwaproject.adb.me-dubai-1.oraclecloudapps.com/ords/SUFEAN/hadith";
        
        // --- ELEMENTS ---
        const categoryNameEl = document.getElementById('category-name');
        const resultsContainer = document.getElementById('results-container');

        // --- HELPER FUNCTIONS ---
        const renderSpinner = (size = 'md') => {
            const sizeClasses = { sm: 'w-8 h-8', md: 'w-10 h-10', lg: 'w-12 h-12' };
            return `<div class="flex justify-center items-center py-10"><div class="${sizeClasses[size]} border-4 border-amber-500 border-t-transparent rounded-full animate-spin"></div></div>`;
        };

        const renderError = (message) => {
            resultsContainer.innerHTML = `<div class="text-center py-10 px-4 bg-[#FFFBF2] rounded-lg shadow-sm"><p class="text-red-500 text-lg">${message}</p></div>`;
        };
        
        // --- FONT SIZE CONTROL ---
        const initFontSizeControl = () => {
            const toggleBtn = document.getElementById('font-size-toggle-btn');
            if (!toggleBtn) return;
            const FONT_SIZES = [16, 18, 20, 22];
            const LS_KEY = 'hadithAppFontSize';
            const applyFontSize = (size) => {
                document.documentElement.style.fontSize = `${size}px`;
                localStorage.setItem(LS_KEY, size);
            };
            const getCurrentSizeIndex = () => {
                const currentSize = parseInt(localStorage.getItem(LS_KEY) || FONT_SIZES[0], 10);
                const index = FONT_SIZES.indexOf(currentSize);
                return index === -1 ? 0 : index;
            };
            const savedSize = localStorage.getItem(LS_KEY);
            if (savedSize) applyFontSize(parseInt(savedSize, 10));
            toggleBtn.addEventListener('click', () => {
                const currentIndex = getCurrentSizeIndex();
                const nextIndex = (currentIndex + 1) % FONT_SIZES.length;
                applyFontSize(FONT_SIZES[nextIndex]);
            });
        };

        // --- MAIN LOGIC ---
        const loadCategoryHadiths = async () => {
            resultsContainer.innerHTML = renderSpinner();
            const params = new URLSearchParams(window.location.search);
            const keyword = params.get('q');
            
            if (!keyword) {
                categoryNameEl.textContent = 'غير محدد';
                renderError("لم يتم تحديد تصنيف.");
                return;
            }
            
            categoryNameEl.textContent = keyword;
            
            try {
                const response = await fetch(`${ORDS_API_BASE_URL}/category/${encodeURIComponent(keyword)}`);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();
                
                if (data.items && data.items.length > 0) {
                    const idKey = data.items[0].hasOwnProperty('id') ? 'id' : 'hadeeth_id';
                    const resultsHTML = data.items.map(h => {
                        const objectID = h[idKey];
                        return `<a href="./details.html?id=${objectID}" class="block">
                                    <div class="bg-[#FFFBF2] p-4 rounded-lg shadow-md hover:shadow-lg transition-shadow border-r-4 border-amber-500">
                                        <p class="text-stone-800 mb-2 text-lg leading-relaxed">${h.text}</p>
                                        <div class="text-sm text-stone-500">
                                            <span>${h.muhaddith || ''}</span> | <span>${h.source || ''}</span> | <span class="font-semibold text-stone-700">${h.hukm || ''}</span>
                                        </div>
                                    </div>
                                </a>`;
                    }).join('');
                    resultsContainer.innerHTML = `<div class="space-y-4">${resultsHTML}</div>`;
                } else {
                    resultsContainer.innerHTML = `<div class="text-center py-10 px-4 bg-[#FFFBF2] rounded-lg shadow-sm"><p class="text-stone-500 text-lg">لا توجد نتائج في هذا التصنيف.</p></div>`;
                }
            } catch (err) {
                console.error(err);
                renderError("حدث خطأ أثناء تحميل البيانات.");
            }
        };

        // --- INITIALIZATION ---
        initFontSizeControl();
        loadCategoryHadiths();
    });
  </script>
</body>
</html>
