<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>أحاديث حسب التصنيف</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Amiri', serif;
        background-color: #FDF6E3; /* Vintage paper background */
      }
      .animate-spin {
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
    </style>
</head>
<body>
    <div class="max-w-4xl mx-auto p-4 sm:p-6 md:p-8">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-stone-800">
                أحاديث في: <span id="category-name-span" class="text-amber-700">جاري التحميل...</span>
            </h1>
            <a href="./index.html" class="px-4 py-2 bg-stone-200 text-stone-800 font-semibold rounded-lg hover:bg-stone-300 transition-colors">
                &rarr; رجوع للبحث
            </a>
        </div>
        
        <div id="results-container">
             <!-- Results will be injected here -->
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const params = new URLSearchParams(window.location.search);
    const keyword = params.get("q");
    const categoryNameSpan = document.getElementById("category-name-span");
    const resultsContainer = document.getElementById("results-container");

    if (!keyword) {
        categoryNameSpan.innerText = "لم يتم تحديد تصنيف";
        resultsContainer.innerHTML = '';
        return;
    }

    categoryNameSpan.innerText = keyword;

    const showLoader = () => {
        resultsContainer.innerHTML = `
          <div class="flex justify-center items-center p-8">
            <div class="w-12 h-12 border-4 border-amber-500 border-t-transparent rounded-full animate-spin"></div>
          </div>`;
    };
    
    showLoader();

    const apiUrl = `https://g85b062bd5c6cb1-fatwaproject.adb.me-dubai-1.oraclecloudapps.com/ords/SUFEAN/hadeeth/search_category/${encodeURIComponent(keyword)}`;

    fetch(apiUrl)
      .then(res => {
          if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
          return res.json();
      })
      .then(data => {
          if (!data.items || data.items.length === 0) {
              resultsContainer.innerHTML = `<div class="text-center py-10 px-4 bg-[#FFFBF2] rounded-lg shadow-sm">
                <p class="text-stone-500 text-lg">لا توجد نتائج في هذا التصنيف.</p>
              </div>`;
              return;
          }
          
          const idKey = data.items[0].hasOwnProperty('id') ? 'id' : 'hadeeth_id';
          
          const resultsHTML = data.items.map(h => `
            <a href="./Details.html?id=${h[idKey]}" class="block">
                <div class="bg-[#FFFBF2] p-4 rounded-lg shadow-md hover:shadow-lg transition-shadow border-r-4 border-amber-500">
                    <p class="text-stone-800 mb-2 text-lg leading-relaxed">${h.text}</p>
                    <div class="text-sm text-stone-500">
                        <span>${h.muhaddith || ''}</span> | <span>${h.source || ''}</span> | <span class="font-semibold text-stone-700">${h.hukm || ''}</span>
                    </div>
                </div>
            </a>
          `).join('');
          resultsContainer.innerHTML = `<div class="space-y-4">${resultsHTML}</div>`;
      })
      .catch(err => {
          resultsContainer.innerHTML = `<div class="text-center py-10 px-4 bg-[#FFFBF2] rounded-lg shadow-sm">
             <p class="text-red-500 text-lg">حدث خطأ أثناء تحميل البيانات.</p>
           </div>`;
          console.error(err);
      });
});
</script>

</body>
</html>
