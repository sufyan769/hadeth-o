<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>أحاديث حسب التصنيف</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Amiri', serif;
        background-color: #FDF6E3; /* Vintage paper background */
      }
      .animate-spin {
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
    </style>
</head>
<body>
    <div id="root" class="max-w-4xl mx-auto p-4 sm:p-6 md:p-8">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-stone-800">
                أحاديث في: <span id="category-name" class="text-amber-700"></span>
            </h1>
            <a href="/" class="px-4 py-2 bg-stone-200 text-stone-800 font-semibold rounded-lg hover:bg-stone-300 transition-colors">
                &rarr; رجوع للبحث
            </a>
        </div>
        
        <div id="content-area">
             <!-- Content will be injected here -->
        </div>
    </div>
    <script type="module">
        const ORDS_API_BASE_URL = "https://g85b062bd5c6cb1-fatwaproject.adb.me-dubai-1.oraclecloudapps.com/ords/SUFEAN/hadeeth";
        
        const categoryNameEl = document.getElementById('category-name');
        const contentArea = document.getElementById('content-area');

        const renderSpinner = () => {
            contentArea.innerHTML = `
                <div class="flex justify-center items-center p-8">
                    <div class="w-12 h-12 border-4 border-amber-500 border-t-transparent rounded-full animate-spin"></div>
                </div>
            `;
        };

        const showError = (message) => {
            contentArea.innerHTML = `<p class="text-center text-red-500">${message}</p>`;
        };

        const renderHadiths = (hadiths) => {
            if (hadiths.length === 0) {
                contentArea.innerHTML = '<p class="text-center text-stone-500">لا توجد أحاديث في هذا التصنيف.</p>';
                return;
            }
            const hadithsHtml = `
                <div class="space-y-4">
                    ${hadiths.map(hadith => `
                        <a href="/Details.html?id=${hadith.id}" class="block">
                            <div class="bg-[#FFFBF2] p-4 rounded-lg shadow-md hover:shadow-lg transition-shadow border-r-4 border-amber-500">
                                <p class="text-stone-800 mb-2 truncate text-lg">${hadith.text}</p>
                                <div class="text-sm text-stone-500">
                                    <span>${hadith.muhaddith || ''}</span> | <span>${hadith.source || ''}</span> | <span class="font-semibold text-stone-700">${hadith.hukm || ''}</span>
                                </div>
                            </div>
                        </a>
                    `).join('')}
                </div>
            `;
            contentArea.innerHTML = hadithsHtml;
        };

        const fetchHadithsByCategory = async () => {
            const params = new URLSearchParams(window.location.search);
            const category = params.get('q');
            
            if (!category) {
                showError("لم يتم تحديد التصنيف.");
                categoryNameEl.textContent = '...';
                return;
            }

            categoryNameEl.textContent = category;
            renderSpinner();

            try {
                const response = await fetch(`${ORDS_API_BASE_URL}/search_category/${encodeURIComponent(category)}`);
                const contentType = response.headers.get("content-type");
                
                if (!response.ok || !contentType || !contentType.includes("application/json")) {
                    throw new Error('حدث خطأ في جلب بيانات التصنيف.');
                }
                const data = await response.json();
                renderHadiths(data.items);
            } catch (err) {
                showError(err.message);
            }
        };

        fetchHadithsByCategory();
    </script>
</body>
</html>
